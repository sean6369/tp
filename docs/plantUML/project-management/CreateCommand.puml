@startuml CreateCommandDiagram
title FlowCLI: create-project Sequence
autonumber

actor User
participant ":FlowCLI Main" as CLI
participant ":CommandParser" as Parser
participant ":CreateCommand" as CreateCmd
participant ":CommandContext" as Ctx
participant ":Projects Model" as Projects
participant ":UI" as UI

User -> CLI: Enter "create-project Alpha"
CLI -> Parser ++: parse("create-project Alpha")
Parser -> CreateCmd ++: new CreateCommand(rawArgs)
Parser -->> CLI: return CreateCommand
deactivate Parser
destroy Parser

CLI -> CreateCmd ++: execute(Ctx)

group Argument parsing
  CreateCmd -> CreateCmd ++: extract project name
  alt name is blank
    CreateCmd -->> CLI: throw MissingArgumentException
    CLI -> UI: showError("Missing project name")
    deactivate CreateCmd
    deactivate UI
    return
  else name valid
    CreateCmd -->> CreateCmd: projectName
  end
  deactivate CreateCmd
end

group Validation
  CreateCmd -> Ctx ++: getProjects(), getUi()
  Ctx -->> CreateCmd: Projects, UI
  deactivate Ctx

  CreateCmd -> Projects ++: getProject(name)
  Projects -->> CreateCmd: project|null
  alt duplicate exists
    CreateCmd -->> CLI: throw ProjectAlreadyExistsException
    CLI -> UI: showError("Project already exists: {name}")
    deactivate CreateCmd
    deactivate UI
    return
  end
  deactivate Projects
end

group Creation
  CreateCmd -> Projects ++: addProject(name)
  Projects -->> CreateCmd: createdProject
  deactivate Projects

  CreateCmd -> UI ++: showAddedProject(createdProject)
  deactivate UI

  CreateCmd -->> CLI: return true
  deactivate CreateCmd
end


destroy CreateCmd
destroy CLI
destroy Ctx
destroy Projects
destroy UI

@enduml
