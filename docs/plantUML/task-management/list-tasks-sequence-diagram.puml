@startuml ListTasksSequenceDiagram
title FlowCLI: list-tasks Sequence

actor User
participant "FlowCLI Main" as CLI
participant "CommandParser" as Parser
participant "ListCommand" as ListCmd
participant "CommandContext" as Ctx
participant "Projects Model" as Projects
participant "Target Project" as Project
participant "UI" as UI

User -> CLI: list 1
CLI -> Parser: parse(...)
Parser --> CLI: ListCommand

CLI -> ListCmd: execute(Ctx)

ListCmd -> Ctx: getProjects(), getUi()
Ctx --> ListCmd: Projects, UI

alt arguments == "--all"
    ListCmd -> Projects: isEmpty()
    alt projects empty
        Projects --> ListCmd: true
        ListCmd --> CLI: EmptyProjectListException
        CLI -> UI: showError("No projects found.")
    else projects exist
        Projects --> ListCmd: false
        ListCmd -> UI: showProjectList()
        ListCmd --> CLI: success
    end
else project index provided
    ListCmd -> Projects: getProjectByIndex(projectIndex)

    alt invalid project index
        Projects --> ListCmd: IndexOutOfRangeException
        ListCmd --> CLI: IndexOutOfRangeException
        CLI -> UI: showError("Invalid project index")
    else valid project
        Projects --> ListCmd: Project
        ListCmd -> Project: isEmpty()

        alt no tasks
            Project --> ListCmd: true
            ListCmd --> CLI: EmptyTaskListException
            CLI -> UI: showError("No tasks found in project.")
        else tasks available
            Project --> ListCmd: false
            ListCmd -> UI: showTaskList(Project)
            ListCmd --> CLI: success
        end
    end
end

@enduml
