@startuml UpdateTaskSequenceDiagram
title FlowCLI: update-task Sequence

actor User
participant "FlowCLI Main" as CLI
participant "CommandParser" as Parser
participant "UpdateCommand" as UpdateCmd
participant "CommandContext" as Ctx
participant "Projects Model" as Projects
participant "Target Project" as Project
participant "UI" as UI

User -> CLI: update-task 1 2 --description Refine spec --deadline 2025-12-25 --priority high
CLI -> Parser: parse(...)
Parser --> CLI: UpdateCommand

CLI -> UpdateCmd: execute(Ctx)

UpdateCmd -> UpdateCmd: validate update fields

opt missing project index or fields
    UpdateCmd --> CLI: InvalidArgumentException
    CLI -> UI: showError("Missing project index or fields to update.")
    return
end

UpdateCmd -> Ctx: getProjects(), getUi()
Ctx --> UpdateCmd: Projects, UI

UpdateCmd -> Projects: getProjectByIndex(projectIndex)

alt invalid project index
    Projects --> UpdateCmd: IndexOutOfRangeException
    UpdateCmd --> CLI: IndexOutOfRangeException
    CLI -> UI: showError("Invalid project index")
else valid project
    Projects --> UpdateCmd: Project
    UpdateCmd -> Project: getTask(taskIndex)

    alt invalid task index
        Project --> UpdateCmd: IndexOutOfRangeException
        UpdateCmd --> CLI: IndexOutOfRangeException
        CLI -> UI: showError("Invalid task index")
    else task located
        Project --> UpdateCmd: Task
        UpdateCmd -> Project: updateTask(taskIndex, new values)
        Project --> UpdateCmd: updatedTask
        UpdateCmd -> UI: showUpdatedTask(Project, updatedTask)
        UpdateCmd --> CLI: success
    end
end

@enduml
