@startuml MarkUnmarkTaskSequenceDiagram
title FlowCLI: mark/unmark-task Sequence

actor User
participant "FlowCLI Main" as CLI
participant "CommandParser" as Parser
participant "MarkCommand" as MarkCmd
participant "CommandContext" as Ctx
participant "Projects Model" as Projects
participant "Target Project" as Project
participant "UI" as UI

User -> CLI: mark 1 2
CLI -> Parser: parse(...)
Parser --> CLI: MarkCommand

CLI -> MarkCmd: execute(Ctx)

MarkCmd -> Ctx: getProjects(), getUi()
Ctx --> MarkCmd: Projects, UI

MarkCmd -> Projects: getProjectByIndex(projectIndex)

alt invalid project index
    Projects --> MarkCmd: IndexOutOfRangeException
    MarkCmd --> CLI: IndexOutOfRangeException
    CLI -> UI: showError("Invalid project index")
else valid project
    Projects --> MarkCmd: Project
    MarkCmd -> Project: markTask(taskIndex)

    alt invalid task index
        Project --> MarkCmd: IndexOutOfRangeException
        MarkCmd --> CLI: IndexOutOfRangeException
        CLI -> UI: showError("Invalid task index")
    else task marked
        Project --> MarkCmd: markedTask
        MarkCmd -> Project: getProjectName()
        Project --> MarkCmd: projectName
        MarkCmd -> UI: showMarked(projectName, markedTask, true)
        MarkCmd --> CLI: success
    end
end

@enduml
